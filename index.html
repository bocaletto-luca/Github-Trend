<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensure proper scaling on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub Trends Dashboard</title>
  <!-- Bootstrap CSS for responsive layout and clean styling -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <style>
    /* Basic body and container styling */
    body {
      background-color: #f8f9fa;
      padding-top: 40px;
      padding-bottom: 80px; /* Extra bottom padding to not hide content behind the fixed footer */
    }
    .container {
      max-width: 1100px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    /* Card styling for each repository */
    .repo-card {
      margin-bottom: 20px;
    }
    /* Fixed footer styling */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #343a40;
      color: #ffffff;
      text-align: center;
      padding: 10px 0;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <!-- Main container for the dashboard -->
  <div class="container">
    <!-- Page header -->
    <h1>GitHub Trends Dashboard</h1>

    <!-- Filter Options Section -->
    <div class="card p-3 mb-4">
      <h4>Filter Options</h4>
      <div class="row g-3">
        <!-- Programming Language Input (optional) -->
        <div class="col-md-4">
          <label for="languageInput" class="form-label">Programming Language (Optional):</label>
          <input type="text" id="languageInput" class="form-control" placeholder="e.g., JavaScript, Python" />
        </div>
        <!-- Topic Input (optional) -->
        <div class="col-md-4">
          <label for="topicInput" class="form-label">Topic/Keyword (Optional):</label>
          <input type="text" id="topicInput" class="form-control" placeholder="e.g., machine learning" />
        </div>
        <!-- Date Filter: created after -->
        <div class="col-md-4">
          <label for="createdAfter" class="form-label">Created After (Date):</label>
          <input type="date" id="createdAfter" class="form-control" />
        </div>
      </div>
      <div class="mt-3">
        <button id="searchBtn" class="btn btn-primary">Search Trending Repositories</button>
      </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="row">
      <!-- Repository cards will be injected here -->
    </div>
  </div>

  <!-- Fixed Footer -->
  <footer>
    Bocaletto Luca
  </footer>

  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    /**********************************************************
     * GitHub Trends Dashboard
     * ---------------------------------------------------------
     * This dashboard fetches trending GitHub repositories using
     * GitHub's search API. It lets the user filter by programming
     * language, keyword/topic, and creation date, then sorts by stars.
     * Results include repository name, description, language,
     * stars, forks, and link to the repository.
     **********************************************************/
    
    // Select DOM elements
    const languageInput = document.getElementById("languageInput");
    const topicInput = document.getElementById("topicInput");
    const createdAfterInput = document.getElementById("createdAfter");
    const searchBtn = document.getElementById("searchBtn");
    const resultsDiv = document.getElementById("results");

    // Add event listener to the search button
    searchBtn.addEventListener("click", function() {
      // Read filter values
      const language = languageInput.value.trim();
      const topic = topicInput.value.trim();
      const createdAfter = createdAfterInput.value;
      
      // Build the query string for the GitHub search API
      // Start with an empty query
      let query = "";
      
      // Add language filter if provided
      if (language) {
        query += `language:${language} `;
      }
      // Add topic/keyword filter - this appears in the repository description, name, etc.
      if (topic) {
        query += `${topic} `;
      }
      // Add created filter if provided
      if (createdAfter) {
        query += `created:>${createdAfter} `;
      }
      // Trim any extra white space in the query string
      query = query.trim();

      // If no query items given, default to a recent time period to get trending repos
      if (query === "") {
        // Default filter: created in the last 7 days
        const defaultDate = new Date();
        defaultDate.setDate(defaultDate.getDate() - 7);
        query = `created:>${defaultDate.toISOString().substr(0, 10)}`;
      }

      // Final API URL: sort by stars in descending order
      // We ask for 30 results per page (default)
      const apiUrl = `https://api.github.com/search/repositories?q=${encodeURIComponent(query)}&sort=stars&order=desc&per_page=30`;
      
      // Debug: log the API URL
      console.log("API URL:", apiUrl);
      
      // Fetch data from GitHub REST API search endpoint
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error("Network response was not ok " + response.status);
          }
          return response.json();
        })
        .then(data => {
          // Render the results on the page
          displayResults(data.items);
        })
        .catch(error => {
          console.error("Error fetching repositories:", error);
          resultsDiv.innerHTML = `<p class="text-danger">Error fetching trending repositories. Please try again later.</p>`;
        });
    });

    /**
     * Display the repository results.
     * @param {Array} repos - Array of repository objects from GitHub API.
     */
    function displayResults(repos) {
      // Clear any previous results
      resultsDiv.innerHTML = "";
      
      // If no results, show a message
      if (!repos || repos.length === 0) {
        resultsDiv.innerHTML = `<p class="text-warning">No repositories found for this filter.</p>`;
        return;
      }
      
      // Loop through each repository object
      repos.forEach(repo => {
        // Create a Bootstrap card for each repository
        const colDiv = document.createElement("div");
        colDiv.className = "col-md-6 col-lg-4";
        
        const cardDiv = document.createElement("div");
        cardDiv.className = "card repo-card h-100";
        
        // Card body container
        const cardBody = document.createElement("div");
        cardBody.className = "card-body";
        
        // Repository name as a clickable link
        const repoName = document.createElement("h5");
        repoName.className = "card-title";
        repoName.innerHTML = `<a href="${repo.html_url}" target="_blank" rel="noopener noreferrer">${repo.full_name}</a>`;
        
        // Repository description (if available)
        const description = document.createElement("p");
        description.className = "card-text";
        description.textContent = repo.description || "No description available.";
        
        // Repository metadata: language, stars, forks
        const metadata = document.createElement("p");
        metadata.className = "card-text text-muted";
        metadata.innerHTML = `
          <small>
            ${repo.language ? `<strong>Language:</strong> ${repo.language} | ` : ""}
            <strong>Stars:</strong> ${repo.stargazers_count} | 
            <strong>Forks:</strong> ${repo.forks_count}
          </small>
        `;
        
        // Append repository information to card body
        cardBody.appendChild(repoName);
        cardBody.appendChild(description);
        cardBody.appendChild(metadata);
        
        // Append card body to card
        cardDiv.appendChild(cardBody);
        // Append card to column div
        colDiv.appendChild(cardDiv);
        // Append the column to the results container
        resultsDiv.appendChild(colDiv);
      });
    }
  </script>
</body>
</html>
